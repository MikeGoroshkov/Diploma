## <center>Дипломный проект</center>
### <center>"Создания Desktop-игры на Python с использованием библиотеки Pygame и с применением возможностей нейросетей"</center>
### Студент: Горошков М.Н.
### Группа: 3246
### Программа "Цифровые профессии. Разработчик. Программист"

## <center>**Содержание проекта:**</center>
1. [Введение](#1)
2. [Основная часть](#2)
   1. [Обзор библиотеки Pygame](#2.1)
   2. [Создание окна и отображение графики](#2.2)
   3. [Работа с изображениями и звуком](#2.3)
   4. [Создание игровых объектов и их движение](#2.4)
   5. [Реализация игровой логики и управление объектами](#2.5)
   6. [Создание меню и интерфейса пользователя](#2.6)
   7. [Применение нейросетевых моделей](#2.7)
   8. [Сборка приложения](#2.8)
   9. [Тестирование и отладка игры](#2.9)
3. [Заключение](#3)
4. [Список используемой литературы](#4)
5. Приложения:
   1. Исходный код игры
   2. Графические приложения

## <a id="1"><center>**1. Введение**</center></a>

В данном проекте будет рассмотрена разработка игры в жанре **platformer** с элементами **rpg** на языке 
программирования **Python**. Жанр platformer/rpg сочетает в себе элементы двух популярных жанров игр: платформеров и rpg.
Платформеры - это игры, в которых игрок управляет персонажем, который должен преодолевать препятствия и сражаться 
с врагами на пути к цели. RPG - это аббревиатура на английском языке, которую можно расшифровать как Role-Playing Game, 
что переводится буквально как «ролевая игра». Ролевая игра - это жанр компьютерных игр, основанный на элементах игрового 
процесса традиционных настольных ролевых игр. В таких играх игроки могут выбирать своих персонажей и управлять ими в 
вымышленном мире. Игроки могут взаимодействовать с другими персонажами и окружающей средой, выполнять задания и 
развивать своих персонажей. В ходе работы будет рассмотрено создание игровых объектов, реализация игровой логики 
и управление объектами, а также создание меню и интерфейса пользователя.

**Целью данного проекта** является более глубокое изучение возможностей языка Python, так как изучение Python 
может помочь мне улучшить свои навыки программирования и открыть для себя новые возможности. Python широко используется 
в различных областях, таких как веб-разработка, научные вычисления, анализ данных и машинное обучение. Python также 
является одним из самых популярных языков программирования в мире.
В ходе дальнейшего обучения после программы "Разработчик" по направлению "Data science" Python будет основным языком 
программирования для меня.

Data science также может быть полезен для разработки игр в нескольких аспектах. Например, вы можете использовать анализ 
данных для определения того, какие элементы игры наиболее популярны среди пользователей, и использовать эту 
информацию для улучшения игрового процесса и увеличения удовлетворенности пользователей. Также вы можете использовать 
машинное обучение для создания более интеллектуальных противников в игре. Например, вы можете использовать алгоритмы 
машинного обучения для обучения ИИ противника на основе поведения пользователя и создания более реалистичного оппонента.

В данном же проекте я буду использовать возможности современных дифузных нейросетевых моделей для создания изображений
для визуальной части игры, а также языковых моделей для написания сюжета.

## <a id="2"><center>**2. Основная часть**</center></a>

###  <a id="2.1">I. Обзор библиотеки Pygame</a>

**Pygame** - это библиотека модулей для языка программирования Python, созданная для разработки 2D игр. Pygame может 
называться фреймворком. Она предоставляет разработчикам множество инструментов для создания игр, включая графический 
движок, звуковой движок и механизмы управления событиями.
Pygame позволяет создавать игры на Python с использованием простых и понятных конструкций языка программирования Python. 
Библиотека Pygame имеет открытый исходный код и доступна для бесплатного скачивания и использования.
Я хочу создать игру, которая будет увлекательной и интересной для пользователей.

Pygame добавляет функциональность поверх превосходной библиотеки SDL. Это позволяет создавать полнофункциональные игры 
и мультимедийные программы на языке python. Pygame очень портативна и работает практически на любой платформе 
и операционной системе. Сама Pygame была скачана миллионы раз.
Pygame бесплатна. Выпущенный по лицензии LGPL, вы можете создавать с его помощью игры с открытым исходным кодом, 
бесплатные, условно-бесплатные и коммерческие.

Многоядерные процессоры можно легко использовать. С распространенными двухъядерными процессорами и дешевыми 
8-ядерными процессорами, доступными в настольных системах, что позволяет использовать многоядерные процессоры.
Использует оптимизированный C и ассемблерный код для основных функций. Код на C часто в 10-20 раз быстрее кода 
на python, а ассемблерный код легко может быть в 100 и более раз быстрее кода на python.

Поставляется со многими операционными системами.
Не нужно возиться с установкой его вне менеджера пакетов вашей операционной системы. Поставляется с установщиками 
(и деинсталляторами) бинарных pos-систем для Windows или MacOSX. Для установки Pygame не требуются инструменты 
настройки даже с ctypes.

Действительно портативна. Поддерживает Linux (pygame поставляется с большинством основных дистрибутивов Linux), 
Windows (95, 98, ME, 2000, XP, Vista, 64-разрядные Windows и т.д.), Windows CE, BeOS, macOS, Mac OS X, FreeBSD,
NetBSD, OpenBSD, BSD/OS, Solaris, IRIX, и QNX. Код содержит поддержку AmigaOS, Dreamcast, Atari, AIX, OSF/Tru64,
RISC OS, SymbianOS и OS/2, но они официально не поддерживаются. Вы можете использовать его на портативных устройствах,
игровых консолях и компьютере "Один ноутбук на ребенка" (OLPC).
Я буду использовать в проекте множество инструментов, предоставляемых Pygame, для создания графического движка,
звукового движка и механизмов управления событиями.

Pygame прост и удобен в использовании. Дети и взрослые создают стрелялки с помощью pygame. Pygame используется в проекте 
OLPC и преподается на курсах эссе для маленьких детей и студентов колледжей. Он также используется людьми, которые 
впервые программировали на z80 assembler или c64 basic.

Было опубликовано много игр. Включая финалистов Фестиваля инди-игр, финалистов Австралийского фестиваля игр, 
популярное условно-бесплатное программное обеспечение, мультимедийные проекты и игры с открытым исходным кодом. 
Более 660 проектов были опубликованы на веб-сайтах pygame, таких как: требуется список. Еще много игр было выпущено 
с SDL (на котором основана pygame), так что вы можете быть уверены, что большая часть из них была хорошо протестирована
миллионами пользователей.

Вы управляете своим основным циклом. Вы вызываете функции pygame, они не вызывают ваши функции. Это дает вам больший 
контроль при использовании других библиотек и для различных типов программ.

Не требует графического интерфейса для использования всех функций. Вы можете использовать pygame из командной строки,
если хотите использовать его только для обработки изображений, ввода с джойстика или воспроизведения звуков.

Небольшой объем кода библиотеки. В нем нет сотен тысяч строк кода для вещей, которые вы все равно не будете использовать. 
Ядро сохранено простым, а дополнительные функции, такие как библиотеки графического интерфейса и эффекты, 
разрабатываются отдельно за пределами pygame.

Pygame модульный. Вы можете использовать фрагменты pygame отдельно. Хотите использовать другую звуковую библиотеку? 
Это прекрасно. Многие из основных модулей могут быть инициализированы и использованы отдельно.

### <a id="2.2">II. Создание окна и отображение графики</a>

Для создания окна и отображения графики в pygame необходимо выполнить следующие шаги:

1. Импортировать библиотеку pygame и инициализировать ее.

      import pygame

      pygame.init()

2. Создать окно с помощью метода

      pygame.display.set_mode()

В качестве аргументов передаются размеры окна в пикселях.

      screen = pygame.display.set_mode((width, height))

3. Отобразить окно на экране

         pygame.display.flip()

Для отображения графики на окне необходимо использовать методы рисования pygame.
Например, чтобы нарисовать простой прямоугольник на окне, можно использовать следующий код:

      pygame.draw.rect(screen, color, (x,y,width,height))

Где screen - это поверхность для рисования (окно), color - цвет прямоугольника в формате RGB или RGBA, 
(x,y) - координаты верхнего левого угла прямоугольника, width и height - ширина и высота прямоугольника соответственно.

pygame.display.set_caption("заголовок") - это метод, который устанавливает заголовок окна Pygame.
Заголовок окна - это текст, который отображается в верхней части окна.
Например, в моей игре заголовок “Escape from Zefira”

pygame.display.set_icon() - это метод, который устанавливает значок окна Pygame. Значок окна - это изображение, которое 
отображается в верхней левой части окна и в списке задач операционной системы.
Например, если вы хотите установить значок окна “icon.png”, вы можете использовать следующий код:

      icon = pygame.image.load("icon.png")
      
      pygame.display.set_icon(icon)

### <a id="2.3">III. Работа с изображениями и звуком </a>

***Для работы с изображениями***
в Pygame используется модуль pygame.image. С помощью этого модуля вы можете загружать 
изображения и изменять их размеры.

pygame.image.load() - это метод, который загружает изображение из файла и возвращает объект Surface. 
Вы можете использовать этот объект для отображения изображения на экране.

Например, для загрузки фона стартового экрана я использовал использовать следующий код:

      start_bg = pygame.image.load('images/start_screen.png').convert_alpha()

convert_alpha() - это метод, который изменяет формат пикселей изображения на формат с альфа-каналом. 
Это позволяет использовать прозрачность в изображении.

Что-бы отобразить изображение на экране в точке (x, y), вы можете использовать следующий код:

screen.blit(image, (x, y)) - это метод blit(), который копирует содержимое одной поверхности на другую поверхность.

Метод subsurface() в Pygame используется для создания новой поверхности, которая ссылается на родительскую поверхность.
Например, если у вас есть изображение image, и вы хотите получить подповерхность изображения в 
прямоугольной области (x, y, width, height), вы можете использовать следующий код:

      subsurface = image.subsurface(pygame.Rect(x, y, width, height))

Таким образом можно использовать spritesheets. Spritesheets - это изображения, которые содержат несколько спрайтов 
(небольших изображений), которые могут быть использованы в качестве анимации. В Pygame вы можете загрузить спрайты 
из спрайт-листа в объект PygAnimation без необходимости нарезки листа на отдельные файлы изображений.
Имя файла спрайт-листа передается в функцию getImagesFromSpriteSheet(), которая возвращает список объектов 
pygame.Surface. Так создаются анимации персонажа.

Пример создания анимации из таблицы спрайтов:

      spritesheet = pygame.image.load('images/flash_new.png')
      
      walk_frame_width = 43
      
      walk_frame_height = 78
      
      walk_frame_count = 12
      
      walk_pos = [(10 + i * (walk_frame_width + 1), 98) for i in range(walk_frame_count)]
      
      walk_right = [spritesheet.subsurface(pygame.Rect(pos, (walk_frame_width, walk_frame_height))) for pos in walk_pos]
      
      walk_left = [pygame.transform.flip(spritesheet.subsurface(pygame.Rect(pos, (walk_frame_width, walk_frame_height))), True, 
      False) for pos in walk_pos]

Этот код загружает изображение и разбивает его на кадры анимации. Он создает список кадров для движения вправо и влево.
Каждый кадр имеет ширину 43 и высоту 78. Всего есть 12 кадров. Переменная walk_pos содержит координаты каждого кадра на 
изображении. Затем он создает список кадров для движения вправо и влево, используя метод subsurface() для получения 
каждого кадра из изображения.

Для возпроизведения анимации внутри игрового цикла можно использовать такой код:

      screen.blit(walk_armed_right[walk_armed_anim_count], (player_x, player_y))
      
      walk_armed_anim_count += 1

Этот код использует метод blit() для отображения изображения на экране. Он отображает текущий кадр анимации для движения
вправо с помощью переменной walk_armed_anim_count, которая изменяется с каждым проходом цикла.
Координаты отображения на экране задаются переменными player_x и player_y.

***Для работы со звуком***
в Pygame используется модуль pygame.mixer. С помощью этого модуля вы можете загружать звуковые
файлы и проигрывать их.

pygame.mixer.Sound() - это класс для загрузки звуковых файлов в Pygame. Он принимает имя файла или объект файла,
в этом проекте используются файлы формата MP3. Затем вы можете использовать метод play() для воспроизведения звука.  
Он может принимать необязательный аргумент loops, который указывает количество повторений звука. 
Если значение loops равно -1, то звук будет воспроизводиться бесконечно
Вы также можете использовать метод set_volume() для установки громкости звука.

Пример:
      
      intro_sound = pygame.mixer.Sound('sounds/Overrated.mp3')
      
      intro_sound.play(loops=-1)


### <a id="2.4">IV. Создание игровых объектов и их движение </a>

***Создаем главного героя.***

Загрузив изображение для персонажа,

      player_stay_right = spritesheet.subsurface(pygame.Rect((0,6), (43, 78)))

назначаем его нашему герою:

      player = player_stay_right
      player_rect = player.get_rect(topleft=(player_x, player_y)) 


Этот код использует метод get_rect() для получения прямоугольника, который описывает границы изображения.
Метод get_rect() возвращает объект pygame.Rect, который содержит координаты и размеры прямоугольника.
Координаты прямоугольника задаются параметром topleft, который устанавливает координаты верхнего левого
угла прямоугольника.

Эти параметры относятся к главному герою игры.

      walk_speed - скорость передвижения героя без оружия
      walk_armed_speed - скорость передвижения героя с оружием
      player_x - координата x героя на экране
      player_y - координата y героя на экране
      hp - текущее количество здоровья героя
      hp_max - максимальное количество здоровья героя
      player_damage - урон, наносимый героем врагам
      experience - количество опыта, полученного героем
      level - уровень героя

***Для создания врагов в игре***
, количество и параметры которых будут различаться удобно использовать классы, например:

      class Soldier(pygame.sprite.Sprite):
          def __init__(self, x, y, bg_x, bg_y, lev):
              super().__init__()
              self.lev = lev
              self.x = x
              self.y = y
              self.bg_x = bg_x
              self.bg_y = bg_y
              self.alive = True
              self.damage = 20 * self.lev
              self.hp_max = 120 * self.lev
              self.hp = 120 * self.lev
              self.exp = 50 * self.lev
              self.soldier_stay_right = soldier_sheet.subsurface(pygame.Rect((10,2), (76, 78)))
              self.soldier_stay_left = pygame.transform.flip(soldier_sheet.subsurface(pygame.Rect((3,2), (57, 78))), True, False)
          def decrease_hp(self, player_damage):
              self.hp -= player_damage
              if self.hp < 0:
                  self.hp = 0
              if self.hp > self.hp_max:
                  self.hp = self.hp_max

Этот класс представляет врага в игре. Он наследуется от класса pygame.sprite.Sprite.
Конструктор класса принимает следующие параметры:

x - координата x врага на экране

y - координата y врага на экране

bg_x - номер уровня, на котором будет отображаться враг, по горизонтали

bg_y - номер уровня, на котором будет отображаться враг, по вертикали

lev - уровень врага

Класс имеет следующие атрибуты:

alive - флаг, указывающий, жив ли враг

damage - урон, наносимый врагом игроку

hp_max - максимальное количество здоровья врага

hp - текущее количество здоровья врага

exp - количество опыта, получаемого за убийство врага

Класс имеет методы:

decrease_hp() - уменьшает количество здоровья врага на заданное количество

Также класс имеет два атрибута:

soldier_stay_right - изображение спрайта врага, когда он стоит и смотрит направо

soldier_stay_left - изображение спрайта врага, когда он стоит и смотрит налево

Далее можно создать экземпляр данного класса:

      soldier_1 = Soldier(400, 22, 4, 1, 1)

Затем создается список soldiers_full_list, который будет содержать всех врагов данного класса в игре:

      soldiers_full_list = [soldier_1]

Также создается пустой список врагов, учавствующих в игре в данный момент, он будкт меняться:

      soldiers_list_in_game = []


### <a id="2.5">V. Реализация игровой логики и управление объектами </a>

### <a id="2.6">VI. Создание меню и интерфейса пользователя </a>

### <a id="2.7">VII. Сборка приложения</a>

Для сборки приложения будем использовать PyInstaller.

PyInstaller - это инструмент для создания автономных (standalone) исполняемых файлов Python для Windows, Linux и 
Mac OS X, которые можно запускать без установки Python или дополнительных библиотек. Он упаковывает все необходимые 
зависимости, библиотеки и модули в один исполняемый файл, который может быть запущен на другой машине без необходимости
установки Python и всех необходимых модулей. PyInstaller поддерживает многие сторонние библиотеки и позволяет 
оптимизировать размер результирующего файла.

Для упаковки проекта с множеством файлов и зависимостей в pyinstaller необходимо выполнить следующие шаги:

1. Убедитесь, что вы установили PyInstaller на свой компьютер. Если необходимо установить PyInstaller, используйте следующую команду в командной строке:

         pip install pyinstaller

Создайте файл spec для вашего проекта, который перечисляет все файлы и зависимости, на которые имеется ссылка в 
вашем коде. Для создания файла spec используйте команду:

      pyinstaller --name=my_project main.py

Замените my_project на название вашего проекта, а main.py на имя файла, который должен быть запущен, чтобы начать 
работу вашего проекта. PyInstaller автоматически выполнит анализ кода и определит все зависимости и файлы, которые 
должны быть включены в ваш пакет.

Откройте файл spec в вашем редакторе кода. В этом файле вы можете добавить дополнительные ресурсы, на которые ваш 
проект ссылается, в раздел datas:

      a = Analysis(['main.py'],

             pathex=['/path/to/my/project'],

             binaries=[],

             datas=[('/path/to/my/project/data/', 'data/')],

             hiddenimports=[],

             hookspath=[],

             runtime_hooks=[],

             excludes=[],

             win_no_prefer_redirects=False,

             win_private_assemblies=False,

             cipher=None,

             noarchive=False)

В этом примере мы добавляем папку data/ в нашем проекте и помещаем ее в папку, созданную PyInstaller для упаковки
наших нужных файлов. Ресурсы, на которые ваш проект можно также добавить вручную после сборки 
(не подходит для сборки в один файл).

Запустите PyInstaller с использованием файла spec и дополнительной командой --onefile, чтобы создать единственный 
исполняемый файл:

      pyinstaller my_project.spec --onefile

После завершения процесса упаковки вы найдете файл .exe в папке dist вашего проекта. Вы можете убедиться, 
что ваш пакет содержит все зависимости и ресурсы, используя следующую команду:

      pyinstaller --name=my_project --add-data "data/*;data/" main.py

Здесь мы добавляем папку data/ при помощи --add-data параметра в наш пакет. Убедитесь, что ваш пакет содержит
все необходимые зависимости и ресурсы, чтобы он работал корректно.

### <a id="2.8">VIII. Применение нейросетевых моделей</a>

### <a id="2.9">IX. Тестирование и отладка игры</a>

## <a id="3"><center>**3. Заключение**</center></a>

## <a id="4"><center>**4. Список используемой литературы**</center></a>

1. Документация по языку Python (https://www.python.org/doc/).
2. Документация по библиотеке Pygame (https://www.pygame.org/docs/).
3. Статья "Библиотека Pygame" (https://habr.com/ru/articles/588605/).
4. Документация по Pyinstaller (https://pyinstaller.org/)